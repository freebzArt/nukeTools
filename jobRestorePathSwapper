import nuke

new_directory_name = nuke.getInput("Enter the new job folder name:")

def select_and_repath_read_nodes():
    if new_directory_name is None or new_directory_name.strip() == '':
        return  # User canceled the input or provided an empty string

    read_nodes = [node for node in nuke.allNodes() if node.Class() == 'Read']
    for node in read_nodes:
        node.setSelected(True)
    for node in nuke.selectedNodes():
        file_path = node['file'].getValue()
        split_path = file_path.split('/')
        if len(split_path) >= 4:
            split_path.pop(3)  # Remove the old third directory
            split_path.insert(3, new_directory_name)  # Insert the new directory
            new_path = '/'.join(split_path)
            node['file'].setValue(new_path)

def select_and_repath_readgeo_nodes():
    if new_directory_name is None or new_directory_name.strip() == '':
        return  # User canceled the input or provided an empty string

    readgeo_nodes = [node for node in nuke.allNodes() if node.Class() == 'ReadGeo2']
    for node in readgeo_nodes:
        node.setSelected(True)
    for node in nuke.selectedNodes():
        file_path = node['file'].getValue()
        split_path = file_path.split('/')
        if len(split_path) >= 4:
            split_path.pop(3)  # Remove the old third directory
            split_path.insert(3, new_directory_name)  # Insert the new directory
            new_path = '/'.join(split_path)
            node['file'].setValue(new_path)

#UNTESTED - NO CURRENT RESTORE JOBS WITH CAMERAS TO TEST 

def select_and_repath_camera_nodes():
    if new_directory_name is None or new_directory_name.strip() == '':
        return  # User canceled the input or provided an empty string

    #camera_nodes = [node for node in nuke.allNodes() if node.Class() == 'Camera3']
    camera_nodes = [node for node in nuke.allNodes() if node.Class().startswith('Camera')]
    for node in camera_nodes:
        node.setSelected(True)
    for node in nuke.selectedNodes():
        #CHECKING FIRST TO SEE IF THE CAMERA NODE IS READING FROM FILE, OTHERWISE CAN CRASH 
        if node.knob('read_from_file').getValue() == '0.0':
            pass
        else:
            file_path = node['file'].getValue()
            split_path = file_path.split('/')
            if len(split_path) >= 4:
                split_path.pop(3)  # Remove the old third directory
                split_path.insert(3, new_directory_name)  # Insert the new directory
                new_path = '/'.join(split_path)
                node['file'].setValue(new_path)

# Call the function to repath the nodes with user input
select_and_repath_read_nodes()
select_and_repath_readgeo_nodes()
select_and_repath_camera_nodes()
